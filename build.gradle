buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath 'net.wasdev.wlp.gradle.plugins:liberty-gradle-plugin:2.0.1'
    }
}

subprojects {
    apply plugin: 'liberty'
    apply plugin: 'war'

    sourceCompatibility = 1.8

    buildscript {
        repositories {
            mavenCentral()
        }
        dependencies {
            classpath 'net.wasdev.wlp.gradle.plugins:liberty-gradle-plugin:2.0.1'
        }
    }

    repositories {
        mavenCentral()
    }

    dependencies {
        providedCompile group: 'org.eclipse.microprofile', name: 'microprofile', version: '1.2'
        providedCompile group: 'javax', name: 'javaee-api', version: '8.0'
        testCompile group: 'junit', name: 'junit', version: '4.+'
        testCompile group: 'org.eclipse', name: 'yasson', version: '1.0'
        testCompile group: 'org.glassfish', name: 'javax.json', version: '1.1.+'
    }
    
    liberty {
        install {
            // use 1 liberty install for the whole repo
            // TODO: re-enable this one liberty-gradle-plugin bug is fixed
            // baseDir = rootProject.buildDir
            runtimeUrl = "https://public.dhe.ibm.com/ibmdl/export/pub/software/websphere/wasdev/downloads/wlp/beta/wlp-beta-2017.12.0.0.zip"
        }
    }

    libertyDebug.dependsOn 'libertyStop'    
    libertyStart.dependsOn 'libertyStop'
    libertyRun.dependsOn   'libertyStop'
    
    task debug { dependsOn 'libertyDebug' }
    task start { dependsOn 'libertyStart' }
    task stop  { dependsOn 'libertyStop'  }
}
